<!DOCTYPE html>
<html>
<head>
    <title>Video-api</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
</head>
<body>
    <button id="check" name="check">Check attendance</button>
    <script type="text/javascript">
        var listFaceId = [];
        $(function() {
            execDetect();
            if (listFaceId.length>0) {
                for(var i=0;i<listFaceId.length;i++){                    
                    execVerify(listFaceId[i]);
                }    
            }
        });
        //detect face
        function execDetect(){
            <% listImage.forEach(function(image){ %>                       
                $.ajax({
                    url: "https://api.projectoxford.ai/face/v1.0/detect?returnFaceId=true",
                    beforeSend: function(xhrObj){
                    // Request headers
                    xhrObj.setRequestHeader("Content-Type","application/json");
                    xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","<%=key%>");
                },
                type: "POST",
                // Request body
                data: '{"url":"<%=image%>"}',
            })
                .done(function(data) {                    
                    for(var j =0;j< data.length;j++){
                        listFaceId.push(data[j].faceId);    
                    }                 
                })
                .fail(function() {
                    alert("error");
                });
                <% }); %>           
        }

        //verify face
        function execVerify(face_id){
            $.ajax({
                url: "https://api.projectoxford.ai/face/v1.0/verify",
                beforeSend: function(xhrObj){
                // Request headers
                xhrObj.setRequestHeader("Content-Type","application/json");
                xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","<%=key%>");
            },
            type: "POST",
            // Request body
            data: '{"faceId":"'+face_id+'","personId":"81208555-e557-48d3-a1c1-d1d42f6cb339","personGroupId":"opensource1"}',
        })
            .done(function(data) {
                console.log(face_id);
                console.log(data);                            
            })
            .fail(function() {
                alert("error");
            });
        }
    </script>
</body>
</html>